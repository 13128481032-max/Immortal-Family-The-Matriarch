// src/data/newsTemplates.js
// ä¿®çœŸç•Œé‚¸æŠ¥ - æ–°é—»æ¨¡æ¿åº“

export const NEWS_TEMPLATES = {
  // çªç ´å¢ƒç•Œ
  LEVEL_UP: [
    "å¬é—» {actor} è¿‘æ—¥ç´«æ°”ä¸œæ¥ï¼Œä¸€ä¸¾çªç ´è‡³ã€{detail}ã€‘ï¼ŒçœŸæ˜¯ææ€–å¦‚æ–¯ï¼",
    "{actor} é—­å…³å¤šæ—¥ï¼Œç»ˆæˆæ­£æœï¼Œæ™‹å‡ã€{detail}ã€‘ã€‚ä¿®çœŸç•Œåˆå¤šäº†ä¸€ä½å¼ºè€…ã€‚",
    "éœ‡æƒŠï¼{actor} ç«Ÿåœ¨çŸ­çŸ­æ•°æœˆé—´çªç ´è‡³ã€{detail}ã€‘ï¼Œä¸æ„§æ˜¯å¤©éª„ä¹‹å§¿ï¼",
    "ã€å¤©é“é…¬å‹¤ã€‘{actor} è‹¦ä¿®å¤šå¹´ï¼Œä»Šæ—¥ç»ˆç ´ç“¶é¢ˆï¼Œæˆå°±ã€{detail}ã€‘ä¹‹å¢ƒã€‚"
  ],

  // NPCçªç ´
  NPC_BREAKTHROUGH: [
    "é“å‹ {actor} äºè¿‘æ—¥çªç ´è‡³ã€{detail}ã€‘ï¼Œä¿®çœŸç•Œåˆæ·»ä¸€ä½é«˜æ‰‹ã€‚",
    "æƒŠé—» {actor} é—­å…³ç™¾æ—¥ï¼Œç«ŸæˆåŠŸè¸å…¥ã€{detail}ã€‘ï¼",
    "{actor} æ‚Ÿé“æœ‰æˆï¼Œå·²æ™‹å‡ã€{detail}ã€‘ï¼Œå®åŠ›ä¸å¯å°è§‘ã€‚"
  ],

  // çªç ´å¤±è´¥
  BREAKTHROUGH_FAIL: [
    "å¯æƒœï¼{actor} å†²å‡»ã€{detail}ã€‘å¤±è´¥ï¼Œèµ°ç«å…¥é­”ï¼Œä¿®ä¸ºå°½æ•£ã€‚",
    "{actor} å¼ºè¡Œçªç ´ã€{detail}ã€‘ä¸æˆï¼Œåå—é‡åˆ›ï¼Œä»¤äººå”å˜˜ã€‚",
    "ã€ä¿®ä»™ä¸æ˜“ã€‘{actor} å°è¯•çªç ´ã€{detail}ã€‘ï¼Œç»ˆå› æ ¹åŸºä¸ç¨³è€Œå¤±è´¥ã€‚"
  ],

  // ç»“å©š
  MARRIAGE: [
    "å–œæŠ¥ï¼{actor} ä¸ {target} å–œç»“è¿ç†ï¼Œç™¾å¹´å¥½åˆï¼",
    "éœ‡æƒŠï¼{actor} ç«Ÿè¢« {target} æ‹¿ä¸‹äº†ï¼Ÿä¿®ä»™ç•Œåˆå°‘äº†ä¸€ä¸ªå•èº«è´µæ—ã€‚",
    "ã€é“ä¾£ä½³è¯ã€‘{actor} ä¸ {target} ç»“ä¸ºé“ä¾£ï¼Œç¾¡ç…æ—äººã€‚",
    "{actor} ç»ˆäºè„±å•ï¼Œä¸ {target} æºæ‰‹å…±åº¦ä»™é€”ã€‚"
  ],

  // ç”Ÿå­
  BIRTH: [
    "ã€å®¶æ—å–œäº‹ã€‘{actor} å–œå¾—éºŸå„¿ï¼Œå–å {target}ï¼Œç‰¹æ­¤æŠ¥å–œï¼",
    "{actor} äºè¿‘æ—¥è¯ä¸‹ä¸€å­ï¼Œåä¸º {target}ï¼Œå®¶æ—æ·»ä¸è¿›å£ã€‚",
    "æ­å–œï¼{actor} ä¹‹å­ {target} é™ç”Ÿï¼Œæ®æµ‹çµæ ¹èµ„è´¨ä¸å‡¡ã€‚"
  ],

  // NPCæ­»äº¡
  DEATH: [
    "å™©è€—ï¼{actor} äº {location} é­é‡ä¸æµ‹ï¼Œå·²ç„¶é™¨è½ï¼Œä»¤äººæ‰¼è…•ã€‚",
    "{actor} ä»™é€ï¼Œäº«å¹´ {detail} å²ï¼Œä¸€ä»£å¼ºè€…å°±æ­¤è½å¹•ã€‚",
    "ã€æ±Ÿæ¹–å“€æ‚¼ã€‘{actor} å¯¿å…ƒè€—å°½ï¼ŒååŒ–è€Œå»ï¼Œä¿®çœŸç•Œåˆå°‘ä¸€è‹±è±ªã€‚"
  ],

  // æˆ˜æ–—/å‡»è´¥æ•Œäºº
  COMBAT: [
    "ã€å¤§å¿«äººå¿ƒã€‘{actor} äº {location} å‡»è´¥ {target}ï¼Œæ‰¬æˆ‘ä¿®çœŸç•Œå¨åï¼",
    "{actor} ä¸ {target} ä¸€æˆ˜ï¼Œæœ€ç»ˆ {actor} æŠ€é«˜ä¸€ç­¹ï¼Œè·å¾—èƒœåˆ©ã€‚",
    "å¬é—» {actor} åœ¨ {location} é­é‡ {target}ï¼Œç»è¿‡æ¿€æˆ˜æˆåŠŸè„±é™©ã€‚"
  ],

  // å­å—£åŠ å…¥å®—é—¨
  JOIN_SECT: [
    "ã€åèµ·ä¹‹ç§€ã€‘{actor} ä¹‹å­ {target} è¢« {detail} æ”¶ä¸ºå¼Ÿå­ï¼Œå‰é€”æ— é‡ï¼",
    "{target} æˆåŠŸæ‹œå…¥ {detail}ï¼Œä¸ºå®¶æ—äº‰å…‰ã€‚",
    "æ­å–œï¼{target} æµ‹å¾—ä¼˜è´¨çµæ ¹ï¼Œå·²è¢« {detail} æ”¶å…¥é—¨ä¸‹ã€‚"
  ],

  // å­™è¾ˆå‡ºç”Ÿ
  GRANDCHILD: [
    "ã€å››ä¸–åŒå ‚ã€‘{actor} å–œæ·»å­™è¾ˆï¼Œå®¶æ—æ„ˆå‘å…´æ—ºï¼",
    "{actor} ä¹‹å­™å‡ºä¸–ï¼Œå®¶æ—ç¬¬{detail}ä»£è¯ç”Ÿï¼Œå¯å–œå¯è´ºã€‚"
  ],

  // æ¢ç´¢ç§˜å¢ƒ
  EXPLORATION: [
    "{actor} äº {location} æ¢å¾—å¥‡é‡ï¼Œè·å¾— {detail}ã€‚",
    "ã€ç§˜å¢ƒä¼ é—»ã€‘æœ‰äººç›®ç¹ {actor} è¿›å…¥ {location}ï¼Œå½’æ¥æ—¶ä¼¼æœ‰æ‰€è·ã€‚"
  ],

  // å¡«å……æ–°é—»ï¼ˆæ— å¤§äº‹å‘ç”Ÿæ—¶ï¼‰
  FILLER: [
    "ã€å¤©æ°”é¢„æŠ¥ã€‘è¿‘æ—¥çµæ°”å……æ²›ï¼Œæ­£æ˜¯ä¿®ç‚¼çš„å¥½æ—¶æœºã€‚",
    "ã€å¸‚åœºè¡Œæƒ…ã€‘çµçŸ³æ±‡ç‡ç¨³å®šï¼Œä¸¹è¯ä»·æ ¼ç•¥æœ‰ä¸Šæµ®ã€‚",
    "ã€å®—é—¨åŠ¨æ€ã€‘å„å¤§å®—é—¨å‡æœ‰æ‹›æ–°è®¡åˆ’ï¼Œæœ›æœ‰å¿—ä¹‹å£«æŠŠæ¡æœºä¼šã€‚",
    "ã€æ±Ÿæ¹–ä¼ é—»ã€‘æ®è¯´æŸå¤„ç§˜å¢ƒå³å°†å¼€å¯ï¼Œå„è·¯ä¿®å£«æ‘©æ‹³æ“¦æŒã€‚",
    "ã€ä¿®ç‚¼æé†’ã€‘è¿‘æœŸå¤©è±¡å¼‚å¸¸ï¼Œä¿®å£«å‡ºè¡Œéœ€è°¨æ…ã€‚",
    "ã€å…«å¦åŠã€‘æŸå®—é•¿è€ä¹‹å­ç«Ÿä¸é­”ä¿®ä¹‹å¥³ç§ä¼šï¼Œäº‹æƒ…çœŸç›¸å¦‚ä½•ï¼Ÿ",
    "ã€å¹¿å‘Šã€‘é«˜ä»·å›æ”¶äºŒæ‰‹é£å‰‘ï¼Œç«¥åŸæ— æ¬ºï¼",
    "ã€æ‹›è˜ã€‘åˆæ¬¢å®—æ‹›æ–°ï¼Œå¾…é‡ä¼˜åšï¼Œæœ‰æ„è€…é€Ÿæ¥ã€‚"
  ],

  // ========== å¤ä»‡ç³»ç»Ÿä¸“å±æ–°é—» ==========
  
  // å®¿æ•Œæ—¶é—´çº¿äº‹ä»¶
  RIVAL_RISE: [
    "ã€å¤´æ¡ã€‘ç´«éœ„å®—æ–°æ˜Ÿï¼{actor}ä¸€æœˆç­‘åŸºï¼Œæ‰“ç ´é’äº‘åŸç™¾å¹´è®°å½•ï¼ä¼—äººæƒŠå¹å…¶å¤©èµ‹å¼‚ç¦€ã€‚",
    "ã€éœ‡æƒŠã€‘{actor}ä¿®ç‚¼é€Ÿåº¦æƒŠäººï¼ŒçŸ­çŸ­æ•°æœˆä¾¿çªç ´è‡³ã€{detail}ã€‘ï¼Œè¢«èª‰ä¸º'ç™¾å¹´éš¾é‡çš„å¤©æ‰'ï¼"
  ],
  
  RIVAL_ENGAGED: [
    "ã€å–œè®¯ã€‘{actor}ä¸{target}è®¢å©šï¼Œä¸¤å¤§å®¶æ—ç»“ç›Ÿï¼Œé’äº‘åŸè½°åŠ¨ä¸€æ—¶ï¼",
    "ã€å…«å¦ã€‘å¬é—»{target}å¯¹{actor}ä¸€è§é’Ÿæƒ…ï¼Œå½“ä¼—ç«‹èª“æ­¤ç”Ÿåªçˆ±ä¸€äººã€‚è‡³äºå½“å¹´çš„å©šçº¦ï¼Ÿæ—©å·²æˆäº†ç¬‘è¯ã€‚"
  ],
  
  RIVAL_MARRIAGE: [
    "ã€å¤´æ¡ã€‘é‡‘ç‰è‰¯ç¼˜ï¼{target}è¿å¨¶{actor}ï¼Œåé‡Œçº¢å¦†ç¾¡ç…æ—äººï¼",
    "ã€ç››å…¸ã€‘{actor}ä¸{target}å¤§å©šä¹‹æ—¥ï¼Œé’äº‘åŸä¸‡äººç©ºå··ã€‚{target}å½“ä¼—ç«‹èª“ï¼šæ­¤ç”Ÿå”¯çˆ±æ¸…ç‘¶ä¸€äººï¼"
  ],
  
  RIVAL_HEIR: [
    "ã€å®¶æ—å–œæŠ¥ã€‘{actor}å–œå¾—éºŸå„¿{target}ï¼Œè¢«ç«‹ä¸ºæ¥šå®¶ä¸‹ä»»å®¶ä¸»ç»§æ‰¿äººï¼",
    "ã€äººç”Ÿèµ¢å®¶ã€‘{actor}å¯è°“çˆ±æƒ…äº‹ä¸šåŒä¸°æ”¶ï¼Œè°è¿˜è®°å¾—å½“å¹´é‚£ä¸ªåœ¨é›¨å¤œè¢«èµ¶å‡ºé—¨çš„å¯æ€œäººå‘¢ï¼Ÿ"
  ],
  
  // è°£è¨€æ•ˆæœæ–°é—»
  RIVAL_LIGHT_RUMOR: [
    "ã€å…«å¦ã€‘æƒŠï¼æ¥šå®¶å¤©æ‰{actor}ç–‘ä¼¼ä¿®ç‚¼èµ°ç«å…¥é­”ï¼Œå½“ä¼—å¤±æ€ï¼Ÿ",
    "ã€åŠé—´æµä¼ ã€‘{actor}'å¤ºå§è¿åŠ¿'ä¹‹è¯´ç”šåš£å°˜ä¸Šï¼Œæ¥šå®¶ç´§æ€¥è¾Ÿè°£ï¼",
    "ã€ä¼ é—»ã€‘{actor}è¿‘æ—¥ç¥è‰²ç„¦è™‘ï¼Œä¿®ç‚¼è¿›åº¦ä¼¼æœ‰ä¸é¡ºï¼Ÿ"
  ],
  
  RIVAL_HEAVY_RUMOR: [
    "ã€å¤´æ¡ã€‘äººè®¾å´©å¡Œï¼Ÿé¡¾å®¶å°‘ä¸»è¢«æ›å¤œå®¿èŠ±æ¥¼ï¼Œç–‘ä¼¼ä¸{actor}æ„Ÿæƒ…ç ´è£‚ï¼",
    "ã€é‡ç£…ã€‘å¿ƒé­”ç¼ èº«ï¼{actor}å¢ƒç•Œè·Œè½ï¼Œå·²é—­å…³ä¸å‡ºï¼",
    "ã€éœ‡æƒŠã€‘{actor}ä¿®ç‚¼å‡ºç°é‡å¤§é—®é¢˜ï¼Œå®¶æ—éœ‡æ€’ï¼Œç½¢å…å…¶ç»§æ‰¿äººèº«ä»½ï¼Ÿ"
  ],
  
  // å¨èƒåº¦é¢„è­¦æ–°é—»ï¼ˆGameplayå…³é”®ï¼‰
  RIVAL_THREAT_MEDIUM: [
    "ã€æ‚¬èµä»¤ã€‘æ¥šå®¶å‘å¸ƒæ‚¬èµä»¤ï¼šé‡é‡‘å¯»æ‰¾ä¸€åç¥ä¼¼{playerName}çš„å¥³ä¿®ä¸‹è½ã€‚",
    "ã€è­¦è§‰ã€‘{actor}è¿‘æ—¥é¢‘ç¹æ´¾äººå¤–å‡ºæ‰“æ¢æ¶ˆæ¯ï¼Œä¼¼åœ¨å¯»æ‰¾æŸäºº..."
  ],
  
  RIVAL_THREAT_HIGH: [
    "ã€å…¨åŸæˆ’ä¸¥ã€‘é’äº‘åŸå…¨åŸæœæ•ï¼{actor}æ”¾è¯ï¼šæŒ–åœ°ä¸‰å°ºä¹Ÿè¦æŠŠé‚£åª'è€é¼ 'æ‰¾å‡ºæ¥ï¼",
    "ã€ç´§æ€¥ã€‘{actor}æ€’å‘æ‚¬èµç™¾ä¸‡çµçŸ³ï¼Œèª“è¦æ‰¾åˆ°é‚£ä¸ªæ•£å¸ƒè°£è¨€ä¹‹äººï¼"
  ],
  
  RIVAL_THREAT_CRITICAL: [
    "ã€é«˜å±é¢„è­¦ã€‘è¡€æ¦œæ€æ‰‹'æ— å½±'ç°èº«é’äº‘ç•Œï¼æ®ä¼ æ˜¯å—æ¥šå®¶é‡é‡‘è˜è¯·ï¼Œè¦åœ¨ä¸‰æ—¥å†…å–ä¸€äººé¦–çº§ï¼",
    "ã€æ±Ÿæ¹–éœ‡åŠ¨ã€‘{actor}ä¸æƒœè¡€æœ¬è¯·å‡ºè¡€æ¦œç¬¬äº”'é¬¼é¢'ï¼Œç›®æ ‡ç›´æŒ‡æŸç¥ç§˜å¥³ä¿®ï¼",
    "ã€å±æœºã€‘ä¿®çœŸç•Œé¡¶çº§æ€æ‰‹å·²æ¥å•ï¼Œç›®æ ‡èº«ä»½æˆè°œï¼Œä¿®å£«ä»¬äººå¿ƒæƒ¶æƒ¶..."
  ],
  
  // éšåŒ¿è¡Œè¸ªæˆåŠŸåé¦ˆ
  RIVAL_HIDE_SUCCESS: [
    "ã€æœæ•æ— æœã€‘æ¥šå®¶æ’¤å›æ‚¬èµä»¤ï¼Œ{actor}å¤§å‘é›·éœ†æ‘”ç¢åè´µç‰ç›ï¼",
    "ã€å¤±è´¥ã€‘{actor}è€—è´¹å·¨èµ„æœæ•{months}æœˆï¼Œå´ä¸€æ— æ‰€è·ï¼Œé¢œé¢å°½å¤±ã€‚",
    "ã€ä¼ é—»ã€‘{actor}çš„æ€æ‰‹è®¡åˆ’æ³¡æ±¤ï¼Œæ®è¯´å¥¹æ°”å¾—ä¸‰æ—¥æ°´ç±³ä¸è¿›ã€‚"
  ],
  
  // ç”Ÿæ­»å†³æ–—ç»“å±€
  RIVAL_DEFEATED: [
    "ã€éœ‡æ’¼ã€‘æ¥šå®¶å®¶ä¸»{target}æš´æ¯™ï¼ç¥ç§˜å¤§èƒ½{actor}å¤ä»‡æˆåŠŸï¼Œé’äº‘åŸå˜å¤©ï¼",
    "ã€ç»ˆå±€ã€‘å¤šå¹´æ©æ€¨ä¸€æœäº†ç»“ï¼Œ{actor}æ‰‹åˆƒä»‡æ•Œ{target}ï¼Œä¿®çœŸç•Œä¸ºä¹‹éœ‡æƒŠï¼",
    "ã€è½å¹•ã€‘{target}å€’åœ¨è¡€æ³Šä¸­ï¼Œçœ¼ä¸­çš„å…‰èŠ’ç»ˆäºç†„ç­...å¤ä»‡è€…{actor}æ‰¬é•¿è€Œå»ã€‚"
  ],
  
  RIVAL_VICTORY: [
    "ã€æƒ¨è´¥ã€‘{target}æŒ‘æˆ˜{actor}å¤±è´¥ï¼Œèº«å—é‡ä¼¤ï¼Œä¿®ä¸ºå¤§æŸï¼",
    "ã€ä¸è‡ªé‡åŠ›ã€‘{target}ç«Ÿæ•¢æŒ‘æˆ˜{actor}ï¼Œç»“æœè¢«æ‰“å¾—åŠæ­»ï¼ŒçœŸæ˜¯å¯ç¬‘ï¼"
  ]
};

// æ ¹æ®ç±»å‹å’Œæ•°æ®å¡«å……æ¨¡æ¿
export function fillNewsTemplate(type, data) {
  const templates = NEWS_TEMPLATES[type];
  if (!templates || templates.length === 0) {
    return null;
  }

  // éšæœºé€‰æ‹©ä¸€ä¸ªæ¨¡æ¿
  const template = templates[Math.floor(Math.random() * templates.length)];

  // æ›¿æ¢å ä½ç¬¦
  let result = template;
  Object.keys(data).forEach(key => {
    const placeholder = `{${key}}`;
    result = result.replace(new RegExp(placeholder, 'g'), data[key]);
  });

  return result;
}

// ç”Ÿæˆå¤©æœºæ¦œï¼ˆä¿®ä¸ºæœ€é«˜çš„ä¸‰ä¸ªäººï¼ŒåŒ…æ‹¬worldNpcsï¼‰
export function generatePowerRanking(npcs, player) {
  const allCharacters = [];
  
  // åŠ å…¥ç©å®¶
  allCharacters.push({
    name: player.name,
    cultivation: player.currentExp || 0,
    tier: player.tier || 'å‡¡äºº',
    isPlayer: true
  });
  
  // åŠ å…¥ä¸–ç•Œåäººæ± 
  if (player.worldNpcs && player.worldNpcs.length > 0) {
    player.worldNpcs.forEach(worldNpc => {
      allCharacters.push({
        name: worldNpc.name,
        title: worldNpc.title,
        cultivation: worldNpc.currentExp || 0,
        tier: worldNpc.tier || 'å‡¡äºº',
        isPlayer: false
      });
    });
  }
  
  // åŠ å…¥æ´»è·ƒNPCï¼ˆé…å¶ã€å­å—£ç­‰ï¼‰
  if (npcs && npcs.length > 0) {
    npcs.filter(npc => !npc.isDead).forEach(npc => {
      allCharacters.push({
        name: npc.name,
        cultivation: npc.currentExp || 0,
        tier: npc.tier || 'å‡¡äºº',
        isPlayer: false
      });
    });
  }

  // æŒ‰ä¿®ä¸ºæ’åºï¼ˆä¿®ä¸ºç›¸åŒæ—¶æŒ‰tieré¡ºåºï¼‰
  allCharacters.sort((a, b) => {
    if (b.cultivation !== a.cultivation) {
      return b.cultivation - a.cultivation;
    }
    // tieræƒé‡æ’åº
    const tierOrder = ['æ¸¡åŠ«æœŸ', 'å¤§ä¹˜æœŸ', 'åˆä½“æœŸ', 'ç‚¼è™šæœŸ', 'åŒ–ç¥æœŸ', 'å…ƒå©´æœŸ', 'é‡‘ä¸¹æœŸ', 'ç­‘åŸºæœŸ', 'ç»ƒæ°”æœŸ', 'å‡¡äºº'];
    return tierOrder.indexOf(a.tier) - tierOrder.indexOf(b.tier);
  });

  // å–å‰ä¸‰å
  return allCharacters.slice(0, 3).map((char, index) => {
    const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
    const prefix = char.isPlayer ? 'ã€æ¥šå®¶å®¶ä¸»ã€‘' : '';
    const titlePart = char.title ? `ã€${char.title}ã€‘` : '';
    return `${medals[index]} ${prefix}${titlePart}${char.name} - ${char.tier}`;
  });
}
