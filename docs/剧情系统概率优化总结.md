# 📊 剧情系统概率优化总结

## ✅ 优化完成

已成功优化剧情触发概率系统，确保：
- **大概率（70-85%）**触发简短的一句话闲聊
- **小概率（15-30%）**触发专属剧情事件

---

## 🎯 核心改动

### 1. 重构触发逻辑（textEngine.js）

**优化前**：
```
子女 → 100%亲情剧情
身份专属 → 30%概率
浪漫剧情 → 60+好感，50%概率
```

**优化后**：
```
子女 → 25%亲情剧情，75%普通闲聊
成人 → 30%专属事件（根据好感度分配浪漫/身份专属），70%普通闲聊
```

### 2. 完善概率分层（App.jsx）

```
点击"闲聊"
    ↓
① 统一剧情事件（30%）
    ├─ 好感80+ → 70%浪漫 + 30%身份
    ├─ 好感60-79 → 50%浪漫 + 50%身份
    └─ 好感<60 → 100%身份
    ↓
② 选项事件（剩余70%中的15%）
    ↓
③ 普通闲聊（剩余约60%）
```

---

## 📈 实际概率分布

### 低好感度（< 60）
- 身份专属剧情：30%
- 选项事件：10.5%
- **普通闲聊：59.5%** ✅

### 中等好感度（60-79）
- 浪漫剧情：15%
- 身份专属剧情：15%
- 选项事件：10.5%
- **普通闲聊：59.5%** ✅

### 高好感度（≥ 80）
- 浪漫剧情：21%
- 身份专属剧情：9%
- 选项事件：10.5%
- **普通闲聊：59.5%** ✅

### 子女
- 亲情剧情：25%
- **普通闲聊：75%** ✅

---

## 🎯 剧情对应关系

### 性格 → 浪漫剧情
| 性格 | 剧情类型 | 触发条件 |
|------|---------|---------|
| 高冷/清冷/禁欲 | 冰山系 | 好感≥60，专属事件池中触发 |
| 病娇/偏执/疯批 | 占有系 | 好感≥60，专属事件池中触发 |
| 温柔/温润/忠犬 | 温柔系 | 好感≥60，专属事件池中触发 |
| 风流/魅惑/浪荡 | 魅惑系 | 好感≥60，专属事件池中触发 |

### 身份 → 专属剧情
| 身份 | 剧情数量 | 触发条件 |
|------|---------|---------|
| 剑修传人 | 3条 | 专属事件池中30%概率触发 |
| 丹道奇才 | 3条 | 专属事件池中30%概率触发 |
| 魔教护法 | 3条 | 专属事件池中30%概率触发 |
| 佛修 | 3条 | 专属事件池中30%概率触发 |
| 妖族半妖 | 3条 | 专属事件池中30%概率触发 |
| 医修圣手 | 3条 | 专属事件池中30%概率触发 |
| 音修琴者 | 3条 | 专属事件池中30%概率触发 |

### 年龄段 → 亲情剧情
| 年龄段 | 剧情数量 | 触发条件 |
|--------|---------|---------|
| 0-10岁 | 5条 | 子女，25%概率触发 |
| 11-18岁 | 5条 | 子女，25%概率触发 |
| 18岁+ | 5条 | 子女，25%概率触发 |

### 好感度 → 剧情权重
| 好感度 | 浪漫剧情 | 身份专属 | 普通闲聊 |
|--------|---------|---------|---------|
| < 60 | 0% | 30% | 59.5% |
| 60-79 | 15% | 15% | 59.5% |
| ≥ 80 | 21% | 9% | 59.5% |

---

## 🎮 玩家体验

### 典型互动流程

**场景1：初次见面（好感20）**
```
连续闲聊10次：
- 6次：普通闲聊（+2×6 = +12好感）
- 3次：身份专属剧情（+18好感）
- 1次：选项事件（需选择）

总计：好感从20升至约50
```

**场景2：暧昧期（好感70）**
```
连续闲聊10次：
- 6次：普通闲聊（+12好感）
- 1-2次：浪漫剧情（+16好感）
- 1-2次：身份专属剧情（+12好感）
- 1次：选项事件

总计：好感从70升至约110（封顶100）
```

**场景3：亲子互动**
```
连续闲聊10次：
- 7-8次：普通闲聊（+14好感）
- 2-3次：亲情剧情（+20好感）

总计：+34好感
```

---

## 💡 设计优势

### 1. 避免审美疲劳
- 专属剧情不会频繁出现
- 每次触发都是惊喜

### 2. 保持游戏节奏
- 大部分时候是快速的一句话闲聊
- 不会因为长篇剧情影响操作流畅度

### 3. 奖励玩家投入
- 好感度越高，浪漫剧情越多
- 体现了关系深化的过程

### 4. 确保覆盖全面
- 每个性格都有对应的浪漫剧情
- 每个身份都有专属剧情路径
- 不同好感度阶段有不同体验

---

## 📁 相关文档

- [剧情触发概率详解.md](./剧情触发概率详解.md) - 详细的概率计算和案例分析
- [剧情系统使用指南.md](./剧情系统使用指南.md) - 玩家使用指南
- [剧情系统v2更新日志.md](./剧情系统v2更新日志.md) - 版本更新记录

---

## 🔧 技术细节

### 修改的文件
1. `src/game/textEngine.js` - 重构 `getUnifiedInteractionEvent()` 函数
2. `src/App.jsx` - 优化闲聊触发逻辑

### 核心代码
```javascript
// textEngine.js - 30%专属事件，70%返回null
const eventRoll = Math.random();
if (eventRoll >= 0.3) return null;

// App.jsx - 15%选项事件，85%普通闲聊
if (Math.random() < 0.15) return 选项事件;
return 普通闲聊;
```

---

## ✅ 验证结果

- ✅ 代码编译无错误
- ✅ 概率分配合理
- ✅ 所有剧情类型都有触发路径
- ✅ 好感度、性格、身份对应关系明确

---

**更新时间**：2026-01-25  
**版本**：v2.1  
**状态**：✅ 已完成
