# 🎭 剧情系统 v2.0 更新日志

## 版本 2.0.0 - 2026-01-25

### ✨ 重大更新

#### 1. 大幅扩充 NPC 系统
- 🎭 **20种性格类型**（从5种扩充到20种）
  - 新增：清冷、忠犬、深情、狂傲、腹黑、呆萌、冷酷、慵懒、狡黠等
- 🏛️ **20种身份类型**（从5种扩充到20种）
  - 新增剑修、丹师、阵法师、符箓师、佛修、医修、音修、妖族等
- 📛 **200+姓名库**
  - 男性名：50+修仙风格名字
  - 女性名：40+古风雅致名字
  - 单姓：48个
  - 复姓：10个（慕容、上官、欧阳等）

#### 2. 身份专属剧情系统
新增7种身份专属剧情，每种3-4条：
- ⚔️ **剑修传人**：论剑、赠剑、剑心共鸣
- 💊 **丹道奇才**：炼丹失败、赠丹、采药之行
- 😈 **魔教护法**：魔功反噬、血契、月下魔音
- 🙏 **佛修**：传经、破戒边缘、舍利相赠
- 🦊 **妖族半妖**：兽性爆发、化形之难、妖丹相护
- 💉 **医修圣手**：诊脉、救人、温泉疗养
- 🎵 **音修琴者**：抚琴、琴心共鸣、琴弦断裂

#### 3. 统一剧情触发机制
**所有剧情现已整合到"闲聊"按钮！**

触发优先级：
1. **子女剧情**（如果是子女，必定触发）
2. **身份专属剧情**（30%概率）
3. **浪漫剧情**（好感60+，50%概率）
4. **选项事件**（30%概率）
5. **普通闲聊**（兜底）

---

### 📝 详细改动

#### 新增文件
- 无

#### 修改文件

##### `src/game/npcGenerator.js`
- ✅ 扩充男性名字库至50+
- ✅ 新增女性名字库40+
- ✅ 扩充单姓库至48个
- ✅ 新增复姓库10个
- ✅ 扩充身份类型至20种
- ✅ 扩充性格类型至20种
- ✅ 为所有新身份添加外貌描述
- ✅ 支持生成指定性别的 NPC

##### `src/game/textEngine.js`
- ✅ 为所有20种身份添加专属对话
- ✅ 新增身份专属剧情库（7种 × 3条 = 21条）
- ✅ 新增 `getIdentityEvent()` 函数
- ✅ 新增 `getUnifiedInteractionEvent()` 统一触发函数
- ✅ 整合所有剧情类型（浪漫、亲情、身份）

##### `src/App.jsx`
- ✅ 导入 `getUnifiedInteractionEvent` 函数
- ✅ 重构闲聊逻辑，使用统一触发函数
- ✅ 移除独立的"深入互动"和"亲子时光"处理代码

##### `src/components/NpcCard/index.jsx`
- ✅ 移除"深入互动"按钮
- ✅ 移除"亲子时光"按钮
- ✅ 简化为4个按钮：详情、闲聊、赠礼、劝生

---

### 🎨 剧情统计

| 类型 | 数量 | 来源 |
|------|------|------|
| 浪漫剧情 | 20 | v1.0 |
| 亲情剧情 | 15 | v1.0 |
| 身份专属剧情 | 21 | v2.0 新增 |
| **总计** | **56** | - |

---

### 🎮 使用体验优化

#### 简化操作
- 之前：需要根据好感度点击不同按钮（闲聊/深入互动/亲子时光）
- 现在：**只需点击"闲聊"**，系统自动选择最合适的剧情！

#### 剧情多样性
每次闲聊可能触发：
- 📖 身份专属剧情（如：剑修的论剑、丹师的赠丹）
- 💕 浪漫剧情（高好感度时）
- 👨‍👩‍👧 亲情剧情（子女）
- 🎲 选项事件（需要做选择）
- 💬 普通对话（基础好感+2）

#### 示例流程
```
玩家遇到一个"剑修传人"，好感度70
点击"闲聊"按钮

可能结果：
- 30%概率：触发"论剑"剧情（身份专属）+5好感
- 35%概率：触发"疗伤"剧情（浪漫）+8好感
- 21%概率：触发选项事件
- 14%概率：普通闲聊 +2好感
```

---

### 🎯 身份剧情预览

#### ⚔️ 剑修传人·论剑
> 慕容玄手按剑柄，眼神锐利如剑："你的剑意还不够凝练。来，与我过过招，我指点你一二。"一番切磋下来，你对剑道的理解更深了一层。

#### 💊 丹道奇才·采药之行
> 上官若兮邀你同去后山采药。一路上，她如数家珍地为你讲解各种灵草的药性。夕阳西下，你们坐在山头，上官若兮忽然说："能有人陪我采药，真好。"

#### 😈 魔教护法·血契
> 夜无双划破手指，鲜血滴落，在虚空中凝成一个诡异的符文："这是血契，从今往后，我们生死相连。你后悔吗？"

#### 🙏 佛修·破戒边缘
> 白云禅看着你，眼神第一次出现波动："你……让贫僧动了凡心。这是破戒之念，本该斩断。可是……"白云禅闭上眼，深吸一口气，"贫僧做不到。"

#### 🦊 妖族半妖·妖丹相护
> 狐千雪从口中吐出内丹，递给你："这是我的妖丹，若遇危险，捏碎它，我必会感应到。"这意味着狐千雪将性命托付于你。

---

### 🔧 技术细节

#### 随机权重设计
```javascript
// 子女剧情：100%触发
if (npc.isChild) return childEvent;

// 身份专属：30%概率
if (Math.random() < 0.3) return identityEvent;

// 浪漫剧情：好感60+，50%概率
if (affection >= 60 && Math.random() < 0.5) return romanceEvent;

// 选项事件：30%概率
if (Math.random() < 0.3) return optionEvent;

// 兜底：普通闲聊
return normalChat;
```

#### 好感度加成
- 普通闲聊：+2
- 身份专属剧情：+4~12
- 浪漫剧情：+5~15
- 亲情剧情：+4~15

---

### 📊 姓名示例

#### 男性名字示例
- 慕容玄 | 上官逸 | 欧阳尘 | 独孤夜
- 云轩辰 | 风煜炎 | 剑无极 | 龙天择

#### 女性名字示例
- 叶清歌 | 萧若兮 | 顾倾城 | 白紫烟
- 慕容婉仪 | 上官凝霜 | 欧阳醉梦 | 独孤采薇

---

### 🐛 修复的问题

- ✅ 修复了 ROMANCE 和 FAMILY 处理代码不完整的问题
- ✅ 修复了 App.jsx 语法错误
- ✅ 优化了闲聊触发逻辑，避免重复代码

---

### 🔮 未来计划

#### v2.1.0（计划中）
- [ ] 为剩余13种身份添加专属剧情
- [ ] 增加每种身份的剧情数量到10条
- [ ] 添加性格与身份的交叉剧情

#### v2.2.0（计划中）
- [ ] 剧情成就系统
- [ ] 剧情收集图鉴
- [ ] 特殊剧情解锁条件

---

### 🎉 总结

v2.0 版本带来了：
- ✅ **10倍**的姓名多样性（从20个到200+）
- ✅ **4倍**的身份类型（从5种到20种）
- ✅ **4倍**的性格类型（从5种到20种）
- ✅ **+60%**的剧情数量（35条到56条）
- ✅ **更流畅**的交互体验（统一到闲聊按钮）

每个 NPC 现在都有独特的身份、性格和专属剧情，让你的修仙世界更加丰富多彩！

---

**最后更新时间**：2026-01-25  
**维护者**：GitHub Copilot
