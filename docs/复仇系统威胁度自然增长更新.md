# 复仇系统威胁度自然增长更新

## 更新日期
2026年1月27日

## 更新内容

### 1. 新增威胁度自然增长机制

#### 功能描述
- 威胁度每月自动缓慢上升
- 复仇成功后威胁度停止上升
- 隐匿期间威胁度不上升
- 威胁度越高，增长速度越快

#### 实现细节

**新增函数：`updateThreatLevel(player)`**
- 位置：`src/game/revengeSystem.js`
- 功能：处理威胁度的每月自然增长

**增长规则：**
```javascript
基础增长：每月 +2
威胁度 < 30：正常增长（×1）
威胁度 30-59：加速增长（×1.2）
威胁度 ≥ 60：快速增长（×1.5）
```

**停止增长条件：**
1. 宿敌已死亡（`rival.isDead === true`）
2. 正在隐匿中（`rival.hiddenTurns > 0`）

### 2. 集成到游戏主循环

**修改位置：**`src/App.jsx` - `handleNextMonth` 函数

**集成逻辑：**
```javascript
// 每月自动调用
1. updateThreatLevel(player) - 威胁度自然增长
2. checkAssassinationEvent(player) - 检查刺杀事件
3. updateRivalTimeline(player) - 年度时间线事件（每12月）
```

### 3. 复仇成功后的处理

**finalDuel 胜利时：**
```javascript
rival.isDead = true;      // 标记已死亡
rival.state = "DEAD";     // 状态变更
rival.threatLevel = 0;    // 威胁度清零
```

威胁度更新函数会自动检测 `isDead` 状态，停止增长。

## 使用示例

### 正常游戏流程
```
月1：威胁度 0 → 2
月2：威胁度 2 → 4
月3：威胁度 4 → 6
...
月15：威胁度 30 → 32（×1.2 = 2.4 ≈ 3）
月16：威胁度 32 → 35
...
月30：威胁度 65 → 68（×1.5 = 3）
```

### 隐匿期间
```
隐匿3月：威胁度保持不变
隐匿结束：继续按规则增长
```

### 复仇成功
```
决斗胜利：威胁度清零，停止增长
之后所有月份：威胁度保持0
```

## 系统交互

### 与散布谣言的关系
- 散布谣言失败：威胁度 +15
- 散布谣言成功（轻度）：威胁度 +10
- 散布谣言成功（重度）：威胁度 +25
- 自然增长与谣言效果叠加

### 与隐匿行踪的关系
- 隐匿期间：威胁度不自然增长
- 隐匿结束：恢复自然增长
- 隐匿直接降低：-40/月

### 与刺杀事件的关系
- 威胁度 ≥ 80：50%概率触发刺杀
- 自然增长使威胁度持续逼近刺杀线
- 玩家需主动管理威胁度

## 平衡性调整

### 增长速度
- **基础增长**：2/月（50个月达到100）
- **加速阶段**：威胁度30后加速，增加紧迫感
- **高危阶段**：威胁度60后快速增长，强制玩家行动

### 对抗手段
1. **隐匿行踪**：-40/月（最有效的降低手段）
2. **生死决斗**：彻底解决威胁
3. **谣言效果**：削弱对手，但反而增加威胁度

## 技术实现

### 文件修改清单
1. `src/game/revengeSystem.js`
   - 新增：`updateThreatLevel()` 函数
   - 位置：`generateThreatWarning()` 之前

2. `src/App.jsx`
   - 导入：`updateThreatLevel, checkAssassinationEvent, updateRivalTimeline`
   - 调用：在 `handleNextMonth()` 的子女成长后、玩家成长前

### 向后兼容
- 保留旧版宿敌系统（`rival.threat`）
- 新版系统使用 `player.rival.threatLevel`
- 两套系统可以并存

## 测试建议

### 测试场景
1. **正常增长**：手动推进50个月，观察威胁度是否达到100
2. **加速增长**：威胁度到达30、60时，观察增长速度变化
3. **隐匿测试**：隐匿期间推进月份，确认威胁度不变
4. **复仇测试**：决斗胜利后，推进月份，确认威胁度保持0
5. **刺杀测试**：威胁度80+时，观察刺杀事件触发

### 预期表现
- 威胁度稳定上升，给玩家压力
- 隐匿提供喘息机会
- 复仇成功后解除威胁
- 整体节奏合理，不过于紧张或松弛

## 后续优化建议

1. **动态威胁源**：根据玩家行为动态调整增长速度
2. **多重威胁**：支持多个宿敌同时存在
3. **威胁事件**：不同威胁度触发不同剧情事件
4. **UI优化**：在复仇面板上显示威胁度趋势图

## 版本信息
- 版本号：v2.1
- 更新类型：功能增强
- 影响范围：复仇系统核心逻辑
