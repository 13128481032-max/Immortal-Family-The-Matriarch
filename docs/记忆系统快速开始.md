# 记忆系统快速开始

## 🎯 一分钟了解

让 LLM "记得" NPC 经历的重要事情,通过**记忆宫殿**实现真正的角色沉浸感。

**核心效果：**
- 玩家问"你后悔吗？" 
- AI 不会说"不后悔"这种空话
- 而是回答"看着小凡长大,当年的痛都值得了"

---

## 🚀 立即使用

### 已自动集成的事件

✅ **生子** - 自动记录里程碑  
✅ **怀孕** - 自动记录近期事件  
✅ **送礼** - 贵重礼物自动升级为里程碑  
✅ **子女成婚** - 自动记录里程碑  
✅ **子女拜师** - 自动记录近期事件  
✅ **对话** - 自动提取记忆并检测关键词  

**你无需写任何代码，系统已经自动运行！**

---

## 🎮 体验效果

### 1. 开始新游戏或加载存档

系统会自动：
- 为所有 NPC 初始化记忆系统
- 为已有子女的 NPC 补录"生子"记忆

### 2. 触发生子事件

当 NPC 生下孩子时，系统自动记录：

```
【里程碑】为你生子
时间：天元5年春
详情：为你诞下张小凡，历经生死劫难，甚至为此损耗了修为根基...
情感烙印：刻骨铭心
```

### 3. 与 NPC 对话

点击 NPC → 选择"💬 传音对话"标签

**试试这些问题：**
- "你还记得当年生孩子的事吗？"
- "那次难产你受苦了吧？"
- "你后悔吗？"
- "我们的孩子现在怎么样？"

AI 会根据记忆给出深情的回复！

### 4. 后台运行说明 ℹ️

**记忆系统主要在后台为 AI 对话服务，不单独展示前端界面。**

如需查看 NPC 的生活记录，请使用游戏已有的**日志系统**：
- 点击 NPC → 滚动到底部 → "📖 查看XX的日志"按钮
- 查看第一人称日记形式的生活轨迹（需好感度 30+）

---

## 📝 关键词列表

在对话中使用这些关键词会触发相关记忆：

**家庭相关：** 孩子、子女、儿子、女儿、怀孕、生子  
**关系相关：** 道侣、结缘、婚配、爱、情、思念  
**情感相关：** 疼、痛、苦、难、后悔、幸福  
**修炼相关：** 突破、境界、修炼、功法、渡劫  
**战斗相关：** 战斗、受伤、生死、救命  

---

## 🎨 对话效果对比

### 场景一：询问生子经历

| 无记忆系统 | 有记忆系统 |
|-----------|-----------|
| "是有些痛苦，但已经过去了。" | "何止是痛...那种撕心裂肺的感觉，我这辈子都忘不了。但看着小凡一天天长大，我从未后悔过。" |

### 场景二：询问孩子近况

| 无记忆系统 | 有记忆系统 |
|-----------|-----------|
| "他...还好吧。" | "小凡已经十岁了，前些日子刚拜入青云门，天赋不俗，我甚是欣慰。" |

### 场景三：询问感受

| 无记忆系统 | 有记忆系统 |
|-----------|-----------|
| "修行路本就艰辛，一切皆是命数。" | "当年为你损耗修为之时，我未曾犹豫。如今看你我子女成才，这点代价又算得了什么？" |

---

## 🔧 进阶操作（可选）

### 手动添加自定义记忆

```javascript
import { addMilestone, EmotionalImpact } from './game/memorySystem.js';

addMilestone(npc, {
  event: "与你共闯禁地",
  time: "天元3年秋",
  detail: "在上古遗迹中，我们九死一生，你为我挡下致命一击...",
  emotionalImpact: EmotionalImpact.UNFORGETTABLE,
  category: "combat",
  tags: ["禁地", "救命", "生死与共"]
});
```

### 查看 NPC 记忆

在浏览器控制台：

```javascript
// 获取当前 NPC（假设在 NPC 详情页）
const npc = window.currentNpc; // 需要你暴露这个变量

// 查看记忆结构
console.log(npc.memories);

// 或使用管理器
import MemoryManager from './game/memoryManager.js';
const summary = MemoryManager.getMemorySummary(npc);
console.log(summary);
```

---

## ❓ 常见问题

**Q: 记忆会不会太多导致 AI 回复变慢？**  
A: 不会。系统最多注入 10 个里程碑 + 5 条近期事件，约 2000 Token，完全在可控范围内。

**Q: 旧存档的 NPC 有记忆吗？**  
A: 有。系统会自动为已有子女的 NPC 补录"生子"记忆。

**Q: 如何让 AI 提到某个特定记忆？**  
A: 在对话中使用相关关键词。例如想让 AI 提到孩子，就问"我们的孩子怎么样？"

**Q: 记忆会被删除吗？**  
A: 里程碑永久保存。近期事件最多 20 条，旧的会被挤掉但重要的会升级为里程碑。

**Q: 可以清空记忆吗？**  
A: 可以，但不建议。如需清空：`MemoryManager.clearAllMemories(npc)`

---

## 🎉 开始体验

1. **启动游戏**
2. **触发一些事件**（生子、送礼、子女成婚等）
3. **点击 NPC 对话**
4. **试试问他"你还记得XXX吗？"**

你会发现 AI 的回复变得有血有肉，带着真实的记忆和情感！

---

## 📚 更多资源

- [完整使用指南](./记忆系统使用指南.md)
- [更新日志](./记忆系统更新日志.md)
- [示例代码](../src/game/memoryExamples.js)
- [测试脚本](../scripts/testMemorySystem.mjs)

---

**让你的修仙世界拥有真正的记忆。** 🌟
