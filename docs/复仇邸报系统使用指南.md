# 复仇邸报系统使用指南

## 系统概述

复仇邸报系统是一个基于邸报的复仇玩法，核心玩法是通过散布谣言削弱宿敌，同时管理威胁度以避免被刺杀，最终在合适的时机发起生死决斗完成复仇。

## 核心机制

### 1. 宿敌状态跟踪

宿敌（楚清瑶）具有以下状态：

- **state**: 当前状态
  - `NORMAL` - 正常（春风得意）
  - `ANXIOUS` - 焦虑不安（轻度谣言生效）
  - `FURIOUS` - 暴怒失态（重度谣言生效）
  - `DEAD` - 已然陨落

- **lifeStage**: 生命阶段（触发时间线事件）
  - `0` - 初始状态
  - `1` - 第1年：天才崛起（筑基期）
  - `2` - 第2年：订婚
  - `3` - 第3年：夺夫大婚（金丹初期）
  - `4` - 第5年：生子掌权（金丹中期）

- **threatLevel**: 威胁度（0-100）
  - 0-29: 风平浪静
  - 30-59: 略有察觉
  - 60-79: 高度警戒
  - 80-100: 极度危险（杀手出动）

- **rumorCount**: 谣言累计次数（影响战力削弱）
- **currentExp**: 当前修为
- **tier**: 境界等级

### 2. 玩家操作

#### 散布谣言 (spreadRumor)

**消耗**: 50-150 灵石（可调节）
**冷却**: 每月只能使用一次
**效果**:
- 成功率: 60% + (灵石/200)，最高90%
- 轻度谣言（50-99灵石）:
  - 削弱修为 100
  - 威胁度 +10
  - 宿敌状态变为 ANXIOUS
- 重度谣言（100+灵石）:
  - 削弱修为 200
  - 威胁度 +25
  - 宿敌状态变为 FURIOUS
- 失败:
  - 威胁度 +15
  - 无其他效果

**触发新闻**: `RIVAL_LIGHT_RUMOR` 或 `RIVAL_HEAVY_RUMOR`

#### 隐匿行踪 (hideFromRival)

**消耗**: 30 灵石/月
**持续**: 1-3个月可选
**效果**:
- 威胁度降低: 40 * 月数
- 隐匿期间不会触发刺杀事件
- 威胁度低于30时宿敌状态恢复 NORMAL

**触发新闻**: `RIVAL_HIDE_SUCCESS`

**重要**: 威胁度超过80%时必须使用！

#### 生死决斗 (finalDuel)

**条件**: 至少达到筑基期
**战力计算**:
- 玩家战力 = currentExp + atk * 10
- 宿敌战力 = (currentExp + 500) * (1 - rumorCount * 0.05)
- 胜率 = 玩家战力 / (玩家战力 + 宿敌战力)

**胜利**:
- 宿敌死亡 (isDead = true)
- 复仇完成
- 触发新闻 `RIVAL_DEFEATED`

**失败**:
- 玩家 HP 降至 30%
- 玩家修为损失 30%
- 触发新闻 `RIVAL_VICTORY`

### 3. 自动事件

#### 时间线事件 (updateRivalTimeline)

每年自动检查，触发宿敌的生命阶段事件：

| 年份 | 事件 | 境界 | 新闻类型 |
|------|------|------|----------|
| 第1年 | 天才崛起 | 筑基期 | RIVAL_RISE |
| 第2年 | 订婚 | - | RIVAL_ENGAGED |
| 第3年 | 夺夫大婚 | 金丹初期 | RIVAL_MARRIAGE |
| 第5年 | 生子掌权 | 金丹中期 | RIVAL_HEIR |

宿敌修为每年自然增长 +200（比玩家快）。

#### 威胁度预警 (generateThreatWarning)

根据威胁度自动生成预警新闻：

| 威胁度 | 预警等级 | 新闻类型 |
|--------|----------|----------|
| 30-59 | 警觉 | RIVAL_THREAT_MEDIUM |
| 60-79 | 搜捕 | RIVAL_THREAT_HIGH |
| 80-100 | 高危 | RIVAL_THREAT_CRITICAL |

#### 刺杀事件 (checkAssassinationEvent)

**触发条件**: 威胁度 ≥ 80 且不在隐匿期
**触发概率**: 50%

**生存率**: 30% + (玩家机敏/200)，最高60%

**幸存**:
- HP 降至 40%
- 威胁度降低 20

**被杀**:
- 游戏结束

## 邸报优先级系统

邸报生成按以下优先级处理新闻：

### 优先级1: 高威胁预警（Gameplay关键）
- 威胁度 ≥ 80: 血榜杀手出动
- 威胁度 ≥ 60: 全城搜捕
- 威胁度 ≥ 30: 悬赏令发布

### 优先级2: 时间线事件
- 宿敌的人生大事（崛起、订婚、结婚、生子）

### 优先级3: 玩家操作反馈
- 谣言效果（轻度/重度）
- 隐匿成功
- 决斗结果

### 优先级4: 日常填充
- 其他游戏事件或填充新闻

## 新闻模板示例

### 宿敌时间线

```javascript
RIVAL_RISE: "【头条】紫霄宗新星！{actor}一月筑基，打破青云城百年记录！"
RIVAL_MARRIAGE: "【头条】金玉良缘！{target}迎娶{actor}，十里红妆羡煞旁人！"
RIVAL_HEIR: "【家族喜报】{actor}喜得麟儿{target}，被立为楚家下任家主继承人！"
```

### 谣言效果

```javascript
RIVAL_LIGHT_RUMOR: "【八卦】惊！楚家天才{actor}疑似修炼走火入魔，当众失态？"
RIVAL_HEAVY_RUMOR: "【头条】人设崩塌？顾家少主被曝夜宿花楼，疑似与{actor}感情破裂！"
```

### 威胁度预警

```javascript
RIVAL_THREAT_CRITICAL: "【高危预警】血榜杀手'无影'现身青云界！据传是受楚家重金聘请，要在三日内取一人首级！"
```

### 复仇结局

```javascript
RIVAL_DEFEATED: "【震撼】楚家家主{target}暴毙！神秘大能{actor}复仇成功，青云城变天！"
```

## 推荐玩法流程

### 第1阶段：蛰伏期（第1-2年）
1. 专注提升自身修为
2. 观察邸报了解宿敌动向
3. 威胁度保持在30以下

### 第2阶段：削弱期（第2-4年）
1. 开始散布谣言（建议50-70灵石）
2. 当威胁度超过60时使用隐匿行踪
3. 循环操作，累积谣言效果

### 第3阶段：决战期（第4年后）
1. 确保自己达到筑基期或更高
2. 通过谣言将宿敌削弱至少5次（-25%战力）
3. 选择威胁度较低时发起生死决斗

### 风险管理
- **低风险策略**: 每次只用50灵石，配合频繁隐匿
- **高风险策略**: 使用100+灵石重度谣言，快速削弱但威胁度飙升
- **平衡策略**: 70-80灵石中度投入，每3次谣言后隐匿1次

## 数据结构

在 `initialPlayer.js` 中添加：

```javascript
rival: {
  name: "楚清瑶",
  state: "NORMAL",
  lifeStage: 0,
  threatLevel: 0,
  rumorCount: 0,
  hiddenTurns: 0,
  isDead: false,
  relationValue: -100,
  tier: "炼气初期",
  currentExp: 300
},

revengeActions: {
  lastRumorMonth: 0,
  totalRumors: 0,
  assassinationAttempts: 0,
  hidingMonths: 0
}
```

## 集成步骤

1. 在 `gazetteSystem.js` 中导入复仇系统函数
2. 在 `generateLocalGazette` 中按优先级处理复仇新闻
3. 在 `App.jsx` 中集成 `RevengePanel` 组件
4. 在游戏主循环中定期调用 `checkAssassinationEvent`
5. 在时间推进时调用 `updateRivalTimeline`

## 注意事项

1. **保存系统兼容**: 确保 rival 和 revengeActions 数据能正常保存和加载
2. **UI适配**: RevengePanel 组件已适配移动端
3. **平衡性**: 根据测试调整战力计算和威胁度增长速度
4. **提示系统**: 当威胁度超过80时，建议在UI多处显示警告

## 调试命令

在浏览器控制台中可以使用以下命令调试：

```javascript
// 查看宿敌状态
console.log(player.rival);

// 手动设置威胁度
player.rival.threatLevel = 85;

// 手动设置谣言次数
player.rival.rumorCount = 5;

// 手动推进时间线
player.rival.lifeStage = 3;
```

## 未来扩展

1. **多宿敌系统**: 支持多个复仇目标
2. **复仇支线**: 针对宿敌的特殊剧情任务
3. **阵营系统**: 复仇行动影响与各宗门的关系
4. **AI生成**: 使用AI生成个性化的复仇新闻
5. **复仇成就**: 不同复仇方式解锁不同成就
