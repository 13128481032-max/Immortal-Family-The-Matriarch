# 🎭 剧情系统使用指南 v2.0

## 📖 系统概述

本游戏现已集成**三轨剧情系统**，包含：
- 🌹 **红尘羁绊·伴侣篇** - 根据 NPC 性格触发不同风格的浪漫剧情（20条）
- 👨‍👩‍👧 **血脉温情·子女篇** - 根据子女年龄段展现成长故事（15条）
- 🎯 **身份传奇·专属篇** - 根据 NPC 身份触发独特剧情（21条）

**v2.0 重大更新**：所有剧情现已整合到"闲聊"按钮，一键触发多种剧情！

---

## 🎮 如何触发剧情

### 💡 统一触发方式（v2.0）

**现在只需点击"闲聊"按钮！**

系统会智能选择最合适的剧情类型：
1. 如果是**子女** → 触发亲情剧情
2. 如果有**身份专属剧情** → 30%概率触发
3. 如果**好感度≥60** → 50%概率触发浪漫剧情
4. 其他情况 → 30%概率触发选项事件或普通闲聊

### 触发示例

```
遇到一个"剑修传人"，好感度70

点击"闲聊"按钮，可能出现：

✅ 30%概率：
   【论剑】
   慕容玄手按剑柄，眼神锐利如剑："你的剑意还不够凝练。
   来，与我过过招，我指点你一二。"
   （身份专属剧情 +5好感）

✅ 35%概率：
   【疗伤】
   慕容玄眉头紧锁，微凉的指尖沾着药膏，轻轻划过你背后的伤口。
   当你因刺痛而轻颤时，慕容玄动作一顿，声音比平日暗哑了几分：
   "忍着点……别乱动，否则我不敢保证还能止乎礼。"
   （浪漫剧情 +8好感）

✅ 21%概率：
   触发选项事件（需要做选择）

✅ 14%概率：
   普通闲聊 +2好感
```

---

### 📊 NPC 多样性（v2.0新增）

#### 🎭 性格类型（20种）
| 性格 | 特点 | 性格 | 特点 |
|------|------|------|------|
| 高冷 | 拒人千里 | 清冷 | 清心寡欲 |
| 温柔 | 如沐春风 | 温润 | 温文尔雅 |
| 傲娇 | 口是心非 | 狂傲 | 狂傲不羁 |
| 病娇 | 占有欲强 | 偏执 | 执念深重 |
| 正直 | 眼里揉不得沙子 | 重利 | 唯利是图 |
| 忠犬 | 至死不渝 | 深情 | 情深意重 |
| 风流 | 风流倜傥 | 魅惑 | 魅惑众生 |
| 坚韧 | 百折不挠 | 腹黑 | 笑里藏刀 |
| 呆萌 | 天真可爱 | 冷酷 | 冷酷无情 |
| 慵懒 | 慵懒散漫 | 狡黠 | 狡猾机智 |

#### 🏛️ 身份类型（20种）
| 身份 | 特色 |
|------|------|
| 落魄散修 | 四海为家，艰难求生 |
| 世家庶子 | 名门庶出，备受冷落 |
| 宗门天骄 | 天之骄子，众星捧月 |
| **剑修传人** | **剑道天才，杀伐果断** |
| **丹道奇才** | **精通炼丹，药香满身** |
| **阵法大师** | **精通阵法，神鬼莫测** |
| **符箓高手** | **符箓造诣，镇山河** |
| **佛修** | **六根清净，普渡众生** |
| **魔教护法** | **亦正亦邪，危险迷人** |
| **血海魔君** | **血炼魔功，凶威赫赫** |
| **幻术妖姬** | **魅惑众生，红颜祸水** |
| **炼尸宗徒** | **操控僵尸，阴森可怖** |
| **凡间书生** | **满腹经纶，误入修真** |
| **妖族半妖** | **妖族血脉，野性难驯** |
| **古族遗民** | **上古血脉，神通觉醒** |
| **器修天才** | **炼器大师，神兵利器** |
| **医修圣手** | **妙手回春，悬壶济世** |
| **毒修鬼才** | **百毒不侵，谈毒色变** |
| **音修琴者** | **以音入道，琴音杀人** |
| **剑冢守墓人** | **世代守护，剑灵相助** |

#### 📛 姓名库（200+）
- **男性名**：50+ （如：清寒、绝尘、无极、天择）
- **女性名**：40+ （如：清歌、若兮、倾城、醉梦）
- **单姓**：48个 （常见单字姓）
- **复姓**：10个 （慕容、上官、欧阳、独孤等）

---

## 🎨 剧情内容一览

### 🌹 伴侣篇剧情库（20条）

**性格类型与剧情风格**：

| 性格标签 | 剧情风格 | 特点 |
|---------|---------|------|
| 高冷、清冷、禁欲 | 冰山系 | 克制后的失控，暗火涌动 |
| 病娇、偏执、疯批 | 占有系 | 危险的试探，强烈的排他性 |
| 温柔、温润、忠犬 | 温柔系 | 无微不至的呵护，细水长流 |
| 风流、魅惑、浪荡 | 魅惑系 | 言语挑逗，若即若离 |

**剧情示例**：
```
【高冷型·疗伤】
陆昭眉头紧锁，微凉的指尖沾着药膏，轻轻划过你背后的伤口。
当你因刺痛而轻颤时，陆昭动作一顿，声音比平日暗哑了几分：
"忍着点……别乱动，否则我不敢保证还能止乎礼。"
```

---

### 2️⃣ 子女亲情剧情

**解锁条件**：
- NPC 是你的子女（`isChild = true`）

**触发方式**：
1. 在子女的 NPC 卡片上找到 **🏡 亲子时光** 按钮
2. 点击按钮即可触发一段随机的亲子剧情
3. 剧情会根据子女的年龄段自动匹配

**年龄段与剧情主题**：

| 年龄段 | 主题 | 特点 |
|--------|------|------|
| 0-10岁（幼年） | 依赖、童真 | 撒娇、分享、模仿 |
| 11-18岁（少年） | 叛逆、成长 | 受伤、心事、远行 |
| 18岁以上（成年） | 反哺、孝心 | 归家、护短、寿礼 |

**剧情示例**：
```
【幼年期·分享】
小小的明月满身泥土地跑回来，献宝似的摊开脏兮兮的小手，
掌心里躺着一颗被捏得有些变形的灵果：
"娘亲吃！这是我在后山找到的最甜的一颗，我不吃，都给娘亲！"
```

---

## 🎨 剧情内容一览

### 伴侣篇剧情库

#### 🧊 高冷/禁欲型（5个剧情）
- 疗伤
- 传道
- 醉酒
- 深夜独处
- 共渡心魔

#### 🔪 病娇/占有型（5个剧情）
- 吃醋
- 对视
- 索取
- 标记
- 囚禁威胁

#### 🌸 温润/忠犬型（5个剧情）
- 晨起
- 赠礼
- 承诺
- 披衣
- 受伤代价

#### 💋 风流/魅惑型（5个剧情）
- 调笑
- 共浴
- 品酒
- 抚琴
- 夜访

---

### 🎯 身份专属剧情库（21条）NEW!

#### ⚔️ 剑修传人（3条）
- 论剑 | 赠剑 | 剑心共鸣

**示例**：
```
【剑心共鸣】
慕容玄盘坐于剑冢之前，感悟剑意。你静静陪在身旁，忽然间，
你感觉到一股凌厉的剑意从慕容玄身上迸发，与你的心神产生共鸣。
慕容玄睁眼，眼中闪过一丝惊讶："你的剑心……竟能与我共鸣？"
```

#### 💊 丹道奇才（3条）
- 炼丹失败 | 赠丹 | 采药之行

**示例**：
```
【采药之行】
上官若兮邀你同去后山采药。一路上，她如数家珍地为你讲解各种灵草的药性。
夕阳西下，你们坐在山头，上官若兮忽然说："能有人陪我采药，真好。"
```

#### 😈 魔教护法（3条）
- 魔功反噬 | 血契 | 月下魔音

**示例**：
```
【血契】
夜无双划破手指，鲜血滴落，在虚空中凝成一个诡异的符文：
"这是血契，从今往后，我们生死相连。你后悔吗？"
```

#### 🙏 佛修（3条）
- 传经 | 破戒边缘 | 舍利相赠

**示例**：
```
【破戒边缘】
白云禅看着你，眼神第一次出现波动："你……让贫僧动了凡心。
这是破戒之念，本该斩断。可是……"白云禅闭上眼，深吸一口气，
"贫僧做不到。"
```

#### 🦊 妖族半妖（3条）
- 兽性爆发 | 化形之难 | 妖丹相护

**示例**：
```
【妖丹相护】
狐千雪从口中吐出内丹，递给你："这是我的妖丹，若遇危险，捏碎它，
我必会感应到。"这意味着狐千雪将性命托付于你。
```

#### 💉 医修圣手（3条）
- 诊脉 | 救人 | 温泉疗养

#### 🎵 音修琴者（3条）
- 抚琴 | 琴心共鸣 | 琴弦断裂

---

### 👨‍👩‍👧 子女篇剧情库（15条）

#### 👶 幼年期（5个剧情）
- 分享
- 噩梦
- 模仿
- 撒娇
- 第一次御剑

#### 🎓 少年期（5个剧情）
- 受伤
- 心事
- 远行
- 叛逆期
- 突破瓶颈

#### 🦅 成年期（5个剧情）
- 归家
- 护短
- 寿礼
- 传承
- 陪伴

---

## 💡 设计理念

### 好感度阈值设计
- **闲聊**：无门槛，基础+2好感
- **身份专属剧情**：无门槛，但30%概率触发，+5~12好感
- **浪漫剧情**：需要60+好感，50%概率触发，+5~10好感
- **劝生**：需要80+好感

### 智能触发优先级
系统会根据NPC类型和你们的关系，自动选择最合适的剧情：
```
子女 > 身份专属 > 浪漫剧情 > 选项事件 > 普通闲聊
```

---

## 🛠️ 技术实现

### 代码位置
- **剧情文本库**：`src/game/textEngine.js`
- **触发逻辑**：`src/App.jsx` 的 `handleNpcInteract` 函数（CHAT分支）
- **UI 按钮**：`src/components/NpcCard/index.jsx`

### 核心函数
```javascript
export const getUnifiedInteractionEvent = (npc, player)
```

**工作流程**：
1. 判断是否是子女 → 返回亲情剧情
2. 30%概率判断身份专属剧情
3. 好感度≥60时，50%概率判断浪漫剧情
4. 兜底返回null，走原有的选项事件或普通闲聊逻辑

---

## 📝 剧情数据对比

### v1.0 vs v2.0

| 项目 | v1.0 | v2.0 | 提升 |
|------|------|------|------|
| 剧情总数 | 35条 | 56条 | +60% |
| 身份类型 | 5种 | 20种 | +300% |
| 性格类型 | 5种 | 20种 | +300% |
| 姓名库 | ~20个 | 200+个 | +900% |
| 触发方式 | 3个按钮 | 1个按钮 | 简化 |

---

## ❓ 常见问题

**Q: 为什么我点闲聊总是普通对话？**  
A: 剧情触发是概率性的。如果是特殊身份，有30%概率触发专属剧情；好感度60+，有50%概率触发浪漫剧情。多点几次就会触发！

**Q: "深入互动"和"亲子时光"按钮去哪了？**  
A: v2.0已整合到"闲聊"按钮中，系统会自动判断，无需手动选择。

**Q: 子女长大后剧情会变化吗？**  
A: 会！系统会根据子女的实时年龄判断，自动切换剧情池（幼年/少年/成年）。

**Q: 能不能自定义 NPC 的身份和性格？**  
A: 可以！在创建 NPC 时设置 `identity` 和 `personality.label` 字段即可。

**Q: 身份专属剧情只有7种身份有吗？**  
A: 目前是的（v2.0）。未来版本会为所有20种身份添加专属剧情。

---

## 🎉 总结

通过v2.0的升级，你的修仙游戏将拥有：
- ✅ 超强的代入感（性格+身份双重差异化）
- ✅ 极高的可玩性（56条剧情，组合多样）
- ✅ 更好的情感共鸣（伴侣脸红心跳，子女心头一暖，身份特色鲜明）
- ✅ 流畅的操作体验（统一到闲聊按钮）

每个NPC都是独一无二的！

祝你玩得开心！ 💕

